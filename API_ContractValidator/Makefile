# MCP API Contract Validator - Makefile

.PHONY: help build start dev prod test clean docker docker-build docker-run docker-dev docker-prod deploy

# Default target
help:
	@echo "MCP API Contract Validator - Available Commands:"
	@echo ""
	@echo "Development:"
	@echo "  make build      - Build the project"
	@echo "  make start      - Start the server"
	@echo "  make dev        - Start in development mode (security disabled)"
	@echo "  make prod       - Start in production mode (security enabled)"
	@echo "  make test       - Run tests"
	@echo "  make clean      - Clean build artifacts"
	@echo ""
	@echo "Docker:"
	@echo "  make docker-build - Build Docker image"
	@echo "  make docker-run   - Run Docker container"
	@echo "  make docker-dev   - Start development Docker compose"
	@echo "  make docker-prod  - Start production Docker compose"
	@echo ""
	@echo "Deployment:"
	@echo "  make deploy      - Full deployment pipeline"
	@echo ""

# Build targets
build:
	@echo "ğŸ“¦ Building project..."
	npm run build

start: build
	@echo "ğŸš€ Starting server..."
	npm run start

dev:
	@echo "ğŸ› ï¸ Starting development server..."
	npm run start:dev

prod:
	@echo "ğŸ” Starting production server..."
	npm run start:prod

# Test targets
test:
	@echo "ğŸ§ª Running tests..."
	npm run test

test-watch:
	@echo "ğŸ‘€ Running tests in watch mode..."
	npm run test:watch

test-coverage:
	@echo "ğŸ“Š Running tests with coverage..."
	npm run test:coverage

# Clean targets
clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	rm -rf dist
	rm -rf node_modules
	rm -rf logs
	rm -rf deployment

clean-docker:
	@echo "ğŸ³ Cleaning Docker artifacts..."
	docker system prune -f
	docker volume prune -f

# Docker targets
docker-build:
	@echo "ğŸ³ Building Docker image..."
	npm run docker:build

docker-run: docker-build
	@echo "ğŸš€ Running Docker container..."
	npm run docker:run

docker-dev:
	@echo "ğŸ› ï¸ Starting development Docker compose..."
	npm run docker:dev

docker-prod:
	@echo "ğŸ” Starting production Docker compose..."
	npm run docker:prod

docker-stop:
	@echo "ğŸ›‘ Stopping Docker containers..."
	docker-compose down

docker-logs:
	@echo "ğŸ“‹ Showing Docker logs..."
	docker-compose logs -f

# Deployment targets
deploy: build
	@echo "ğŸš€ Deploying application..."
	npm run deploy

# Quick start targets
quick-dev:
	@echo "ğŸš€ Quick development setup..."
	npm install
	cp .env.example .env
	make dev

quick-prod:
	@echo "ğŸš€ Quick production setup..."
	npm install
	cp .env.example .env
	@echo "âš ï¸  Please edit .env with your production settings"
	@read -p "Press Enter to continue..."
	make prod

# Utility targets
install:
	@echo "ğŸ“¦ Installing dependencies..."
	npm install

lint:
	@echo "ğŸ” Running linter..."
	npm run lint

lint-fix:
	@echo "ğŸ”§ Fixing linting issues..."
	npm run lint:fix

# Health check
health:
	@echo "ğŸ’“ Checking health..."
	curl -f http://localhost:3001/health || echo "âŒ Service not healthy"

# Environment setup
env-dev:
	@echo "ğŸ“ Setting up development environment..."
	cp .env.example .env
	sed -i 's/MCP_AUTH_ENABLED=false/MCP_AUTH_ENABLED=false/' .env
	sed -i 's/MCP_RATE_LIMIT_ENABLED=false/MCP_RATE_LIMIT_ENABLED=false/' .env
	@echo "âœ… Development environment configured"

env-prod:
	@echo "ğŸ“ Setting up production environment..."
	cp .env.example .env
	sed -i 's/MCP_AUTH_ENABLED=false/MCP_AUTH_ENABLED=true/' .env
	sed -i 's/MCP_RATE_LIMIT_ENABLED=false/MCP_RATE_LIMIT_ENABLED=true/' .env
	@echo "âœ… Production environment configured"
	@echo "âš ï¸  Please edit .env with your API keys and secrets"
